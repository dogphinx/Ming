<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>multiple slide loop</title>
    <link rel="stylesheet" href="../css/reset.css">
    <style>
        .slide_wrapper {
            position: relative;
            width: 660px;
            margin: 0 auto;
            height: 200px;
            overflow: hidden;
        }

        .slides {
            position: absolute;
            left: 0;
            top: 0;
        }

        .slides.animated {
            transition: 0.5s ease-out;
        }

        .slides li {
            width: 200px;
            height: 200px;
            background: #ccc;
            float: left;
        }

        .slides li:not(:last-child) {
            margin-right: 30px;
        }

        .controls {
            text-align: center;
            margin-top: 250px;
        }

        .controls span {
            background: #333;
            color: #fff;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="slide-wrapper">
        <ul class="slides">
            <li>slide 01</li>
            <li>slide 02</li>
            <li>slide 03</li>
            <li>slide 04</li>
            <li>slide 05</li>
        </ul>
    </div>

    <p class="controls">
        <span class="prev">prev</span>
        <span class="next">next</span>
    </p>

    <script>
        const slides = document.querySelector('.slides'),
            slide = document.querySelectorAll('.slides li'),
            slideCount = slide.length,
            slideWidth = 200,
            slideMargin = 30,
            prevBtn = document.querySelector('.prev'),
            nextBtn = document.querySelector('.next');
        let currentIdx = 0;

            function makeClone() {
                // 슬라이드의 갯수에 따라서 앞과 뒤에다가 둘다 복사본을 추가할거에요.
                for (let i = 0; i < slideCount; i++) {
                    // 자바스크립트에서 요소를 복사하는 방법은 클론노드가 있습니다.
                    // a.cloneNode() : a 요소를 그대로 복사
                    // a.cloneNode(true)  : a 요소의 자식요소까지 모두 복사
                    let cloneSlide = slide[i].cloneNode(true);
                    cloneSlide.classList.add('clone');
                    // a.appendChild(b) : a 요소의 기존의 내용 뒤에다가 b 를 추가하는 거에요.
                    slides.appendChild(cloneSlide);
                }
                for (let i = slideCount - 1; i >= 0; i--) {
                    let cloneSlide = slide[i].cloneNode(true);
                    cloneSlide.classList.add('clone');
                    // a.prepend(b) : a 요소의 기존의 내용 앞에다가 b 를 추가.
                    slides.prepend(cloneSlide);
                }
                updateWidth();
                setInitialPos();
                setTimeout(function () {
                    slides.classList.add('animated');
                }, 100)
            }

        function updateWidth() {
            const currentSlides = document.querySelectorAll('.slides li'),
                newSlideCount = currentSlides.length,
                newWidth = (slideWidth + slideMargin) * newSlideCount - slideMargin + 'px';
            slides.style.width = newWidth;
        }

        function setInitialPos() {
            let initialTranslateValue = -(slideWidth + slideMargin) * slideCount;
            // slides { transform: translateX(-1000px);}
            slides.style.transform = 'translateX(' + initialTranslateValue + 'px)';
        }

        nextBtn.addEventListener('click', function () {
            moveSlide(currentIdx + 1);
        });
        prevBtn.addEventListener('click', function () {
            moveSlide(currentIdx - 1);
        });

        function moveSlide(num) {
            slides.style.left = -num * (slideWidth + slideMargin) + 'px';
            currentIdx = num;
            console.log(currentIdx, slideCount);

            if (currentIdx === slideCount || currentIdx === -slideCount) {
                setTimeout(function() {
                    slides.classList.remove('animated');
                    slides.style.left = '0px';
                    currentIdx = 0;
                }, 500);

                setTimeout(function() {
                    slides.classList.add('animated');
                }, 600)
            }
        }

        makeClone();
    </script>
</body>

</html>